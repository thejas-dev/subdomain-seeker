<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- <link rel="stylesheet" href="/static/output.css"> -->
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.CSS" rel=" stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style></style>
</head>
<body>
    <!-- <img src="https://ik.imagekit.io/d3kzbpbila/thejashari_gGvNtKEmj" alt="Not found" class="image"/> -->
    <main class="main">
        <div class="alertBox" id="alertBox">
            <h1 class="alert-text">Please enter valid url and dont provide any protocals</h1>
        </div>
        <header class="header">
            <div class="header-container">
                <span>
                    <h1 class="heading">Subdomain seeker</h1><p class="by-name">by thejashari</p>
                </span>
                <img src="https://ik.imagekit.io/thejas/bug.png?updatedAt=1691676538518" alt="" 
                style="width: 28px; height: 55px;"/>
                
            </div>
            
        </header>
        <div class="container2">
            <h3 class="sub-text">Subdomain seeker is a tool to find subdomains of domain with their status code.
                <br><br>Paste your target domain and let subdomain seeker automatically evaluates the domain with 3 lakhs+ subdomains
            </h3>
            <div class="main-card">
                <div class="card-head">
                    <form onsubmit="handleSubmit(event)" class="input-container">
                        <i id="icon" class="fa fa-search" style="color:white;font-size: 20px;" aria-hidden="true"></i>
                        <input type="text" class="card-input" id="card-input"
                        style="font-family: Verdana, Geneva, Tahoma, sans-serif;" 
                        placeholder="Write domain here eg:- google.com"/>
                    </form>

                </div>
                <div class="card-body" id="card-body">
                    
                </div>
            </div>
        </div>
        <div class="placeholder"></div>
    </main>
</body>
    <script>

    const addDataToBody = async(data) => {
        let cardItem = document.createElement('div'); //create card item
        cardItem.classList.add('card-item');
        cardItem.addEventListener('click',(event)=>copyThis(data.subdomain + " [" + data.response + "]"))
        let cardSubdomain = document.createElement('h1');
        cardSubdomain.classList.add('card-item-subdomain'); //add subdomain
        cardSubdomain.textContent = data.subdomain + " [" + data.response + "]"
        cardItem.appendChild(cardSubdomain);
        let cardStatus = document.createElement('h1'); //add response code
        cardStatus.classList.add('card-item-status');
        cardStatus.textContent = data.statusCode;
        switch(data.statusCode){
            case 204:cardStatus.classList.add('green');break;
            case 200:cardStatus.classList.add('green');break;
            case 404:cardStatus.classList.add('red');break;
            case 403:cardStatus.classList.add('red');break;
            case 405:cardStatus.classList.add('red');break;
            case 401:cardStatus.classList.add('red');break;
            case 500:cardStatus.classList.add('red');break;
            case 503:cardStatus.classList.add('red');break;
            case 501:cardStatus.classList.add('red');break;
            case 502:cardStatus.classList.add('red');break;
            case 504:cardStatus.classList.add('red');break;
            case 301:cardStatus.classList.add('blue');break;
            case 302:cardStatus.classList.add('blue');break;
            case 304:cardStatus.classList.add('blue');break;
            default:cardStatus.classList.add('blue');break;
        }
        cardItem.appendChild(cardStatus);
        let container = document.getElementById('card-body');
        container.appendChild(cardItem)
    }

    const socket = new WebSocket(`ws://${location.host}/echo`); 

    socket.addEventListener('message', (event) => {
        console.log('Message from server:', event.data);
        addDataToBody(JSON.parse(event.data));
    });

    socket.addEventListener('open', (event) => {
        console.log('Server connection opened.');
    });

    socket.addEventListener('close', (event) => {
        socket.send("stop-evaluating");
        console.log('WebSocket connection closed');
    });

    function isValidDomain(input) {
        const domainPattern = /^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,})$/;
        return domainPattern.test(input);
    }

    async function handleSubmit(e){
        e.preventDefault();
        let ele = document.getElementById('card-input')
        let icon = document.getElementById('icon')
        value = ele.value;
        if(value.length > 3 && isValidDomain(value)){
            ele.classList.add('blurIt');
            icon.classList.remove('fa-search')
            icon.classList.add('fa-spinner');
            icon.classList.add('fa-pulse');
            ele.disabled = true;
            socket.send(value);
        }else{
            let ele2 =  document.getElementById('alertBox')
            ele2.classList.add('show')
            setTimeout(()=>{
                ele2.classList.remove('show')
            },3500)
        }

    }




    function copyThis(data) {
        event.stopPropagation();

        // var textToCopy = element.querySelector('.card-item-subdomain').textContent;

        var tempTextarea = document.createElement('textarea');
        tempTextarea.value = data;
        document.body.appendChild(tempTextarea);

        tempTextarea.select();
        document.execCommand('copy');

        document.body.removeChild(tempTextarea);

        // element.classList.add('copied');
        // setTimeout(function() {
            // element.classList.remove('copied');
        // }, 1000);
    }

    window.addEventListener('beforeunload',(e)=>{
        alert("are you sure")
        socket.send("stop-evaluating");
    })

    </script>

</html>




<!-- <div onclick="copyThis(this,event)" class="card-item">
    <h1 class="card-item-subdomain">
        mail.google.com [1:212:3212:12321:11] 
    </h1>
    <h1 class="card-item-status green">
        200
    </h1>
</div> -->